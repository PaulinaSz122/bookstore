<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Bookstore</title>
</head>
<body>
    <main>
        <div id="book"></div>
        <div id="book2"></div>
    </main>

    <script>
        (function() {
            const API_URL = 'http://localhost:8080/api';
            var id = getQueryVariable("id")
            getWholeBook(id);

            function getBook(id) {
                fetch(`${API_URL}/books/` + id)
                    .then(processOkResponse)
                    .then(book => {
                        document.getElementById('book').innerHTML = `
                            <h3>Tytuł: ${book.title}</h3>
                            <h4>Autor: ${book.author}</h4>
                            <h4>Cena: ${book.price.toFixed(2)} zł</h4>
                        `;
                });
            }

            function getDescription(book_id){
                fetch(`${API_URL}/description/findOneDescription?book_id=` + book_id)
                    .then(processOkResponse)
                    .then(description => {
                        document.getElementById('book2').innerHTML =  `
                            <h5>Wydawnictwo: ${description.publisher}</h5>
                            <h5>Data wydania: ${description.release_date}</h5>
                            <p>${description.description}</p>
                        `;
                });
            }

            function getWholeBook(id) {
                getBook(id);
                getDescription(id);
            }

            function getQueryVariable(variable)
            {
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for (var i=0;i<vars.length;i++) {
                        var pair = vars[i].split("=");
                        if(pair[0] == variable){return pair[1];}
                }
                return(false);
            }

            function processOkResponse(response = {}) {
                if (response.ok) {
                    return response.json();
                }
                throw new Error(`Status not 200 (${response.status})`);
            }
        }) ();
    </script>
</body>
</html>